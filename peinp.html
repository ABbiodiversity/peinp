<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex MacPhail">
<meta name="dcterms.date" content="2024-01-31">

<title>Report on the use of passive acoustic monitoring for evaluating ecological integrity in Prince Edward Island National Park</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="peinp_files/libs/clipboard/clipboard.min.js"></script>
<script src="peinp_files/libs/quarto-html/quarto.js"></script>
<script src="peinp_files/libs/quarto-html/popper.min.js"></script>
<script src="peinp_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="peinp_files/libs/quarto-html/anchor.min.js"></script>
<link href="peinp_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="peinp_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="peinp_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="peinp_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="peinp_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">Data collection</a></li>
  <li><a href="#data-management" id="toc-data-management" class="nav-link" data-scroll-target="#data-management">Data management</a></li>
  <li><a href="#community-data-processing" id="toc-community-data-processing" class="nav-link" data-scroll-target="#community-data-processing">Community data processing</a></li>
  <li><a href="#visual-scanning" id="toc-visual-scanning" class="nav-link" data-scroll-target="#visual-scanning">Visual scanning</a></li>
  <li><a href="#automated-recognition" id="toc-automated-recognition" class="nav-link" data-scroll-target="#automated-recognition">Automated recognition</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#avian-species" id="toc-avian-species" class="nav-link" data-scroll-target="#avian-species">Avian species</a>
  <ul class="collapse">
  <li><a href="#species-richness" id="toc-species-richness" class="nav-link" data-scroll-target="#species-richness">Species richness</a></li>
  <li><a href="#species-diversity" id="toc-species-diversity" class="nav-link" data-scroll-target="#species-diversity">Species diversity</a></li>
  <li><a href="#species-occupancy" id="toc-species-occupancy" class="nav-link" data-scroll-target="#species-occupancy">Species occupancy</a></li>
  </ul></li>
  <li><a href="#visual-scanning-1" id="toc-visual-scanning-1" class="nav-link" data-scroll-target="#visual-scanning-1">Visual scanning</a></li>
  <li><a href="#amphibians" id="toc-amphibians" class="nav-link" data-scroll-target="#amphibians">Amphibians</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="peinp.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Report on the use of passive acoustic monitoring for evaluating ecological integrity in Prince Edward Island National Park</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alex MacPhail </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 31, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-center" style="float:left`;">
<figure class="figure">
<p><img src="peinpheader.png" class="img-fluid figure-img" alt="Photo of the ocean"></p>
</figure>
</div>
<div class="fullwidth">
<p>To run this report locally:</p>
<ul>
<li>Open RStudio or your preferred IDE</li>
<li>Create a new project and set up for version control using the GitHub repository</li>
<li>Pull from remote main</li>
<li>Load the <code>pei.RData</code> file in the first chunk</li>
<li>Render the document and review the results</li>
</ul>
</div>
<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>This study spans five years and surveys 30 locations in Prince Edward Island to assess avian species distribution. A total of 100 avian species were identified. Despite stable species richness and diversity, variations in species occupancy were noted, attributed to the limited sample size. The study recommends consistent monitoring at core sites during the breeding season, emphasizing the importance of well-maintained acoustic equipment. The potential for extending acoustic monitoring to other taxa, such as amphibians, is also discussed for a more comprehensive ecological evaluation.</p>
<hr>
</section>
<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>Human activities have been identified as key contributors to the global decline in forest wildlife. The repercussions of habitat fragmentation and loss, climate change, and increased access to sensitive areas exert direct and indirect pressures on forest biodiversity, particularly in managed regions.</p>
<p>In 2019, Prince Edward Island National Park initiated a program incorporating autonomous recording units (ARUs) for passive acoustic monitoring (PAM) of the Park’s wildlife. ARUs are compact environmental sensors that are designed to passively record the environment (<span class="citation" data-cites="aru-overview">Shonfield and Bayne (<a href="#ref-aru-overview" role="doc-biblioref">2017</a>)</span>), capturing vocalizing species like birds and amphibians. This technology enables resource managers to conduct prolonged surveys with minimal human interference. The species detected by these units contribute valuable information to ecological integrity metrics such as species richness, diversity, occupancy, and trends over time. This data aids decision-making and management within the Park. Given the rapid and ease of accumulating data from these units, maintaining a high standard of data integrity is paramount to ensure future data interoperability and sharing (<span class="citation" data-cites="aru-overview">Shonfield and Bayne (<a href="#ref-aru-overview" role="doc-biblioref">2017</a>)</span>). <a href="https://www.wildtrax.ca">WildTrax</a> is an online platform developed by the <a href="https://abmi.ca">Alberta Biodiversity Monitoring Institute (<strong>ABMI</strong>)</a> for users of environmental sensors to help addresses these big data challenges by providing solutions to standardize, harmonize, and share data.</p>
<div class="no-row-height column-margin column-container"><div id="ref-aru-overview" class="csl-entry" role="listitem">
Shonfield, Julia, and Erin M Bayne. 2017. <span>“Autonomous Recording Units in Avian Ecological Research: Current Use and Future Applications.”</span> <em>Avian Conservation &amp; Ecology</em> 12 (1).
</div></div><p>The objectives of this report are to:</p>
<ul>
<li>Describe the data management and processing procedures for the acoustic data collected from 2019 to 2023</li>
<li>Identify all audible species and quantify the abundance of each species within each recording</li>
<li>Utilize traditional human tagging, visual scanning and automated recognition techniques to detect species on audio recordings</li>
<li>Define straightforward methods and robust ecological integrity metrics for evaluating species presence, species richness, and species occupancy over time at various locations</li>
<li>Offer recommendations for ongoing monitoring approaches to contribute to the assessment of ecological integrity in forest ecosystems</li>
<li>Facilitate data publication to the public, resource managers, academic institutions, and other relevant agencies</li>
</ul>
<hr>
</section>
<section id="methods" class="level1 page-columns page-full">
<h1>Methods</h1>
<section id="data-collection" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="data-collection">Data collection</h2>
<p>Data were collected during the spring and summer seasons from 2019 to 2023. A total of 30 locations were surveyed over the five-year period:</p>
<ul>
<li>21 locations as part of the forest songbird monitoring program (code: <code>PENP-*</code>) with ARUs recording during the morning hours,</li>
<li>6 for Bank Swallow Monitoring (code: <code>PENP-BS-*</code>) with ARUs placed strategically beside ponds recording in the evening,</li>
<li>2 locations deployed in First Nations communities (<code>ASC-1, LXI-1</code>) to complement the forest songbird and evening schedules,</li>
<li>And one location (<code>PENP-E1</code>), which was to examine the effects of a single public event</li>
</ul>
<p>Locations were surveyed on rotation with 9 locations (PENP-1-1, PENP-1-2, PENP-2-3, PENP-3-1, PENP-3-2, PENP-4-1, PENP-4-2, PENP-4-3, PENP-4-4) were surveyed each year. A detailed list of all survey years can be found in Table 1 (<a href="#tbl-loc-summary">Table&nbsp;1</a>) and illustrated in Figure 1 (<a href="#fig-locs">Figure&nbsp;1</a>). ARUs were deployed at the beginning of the breeding season in April and May and rotated locations until their final retrieval in July and August. At the forest songbird locations (<code>PENP-*</code>), the ARUs were set to record for 30 minutes continuously every hour for four hours, starting one hour before dawn and ending three hours after dawn. For Bank Swallow Monitoring locations (<code>PENP-BS</code>), recordings were made every 5 minutes for a duration of 3 minutes each from 1.5 hours before dusk to 1.5 hours after dusk. On average, each ARU recorded for 11.27 +/- 8.03 days.</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-locs" class="quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="peinp_files/figure-html/fig-locs-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption margin-caption">Figure&nbsp;1: Locations surveyed each year</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-loc-summary" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;1: Locations surveyed across years. Ones indicated a deployment in that year for that location</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Location</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2019</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2020</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2021</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2022</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2023</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Site</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Cavendish</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Cavendish</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-1-3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Cavendish</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-2-3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Brackley</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-3-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Dalvay</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-3-2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Dalvay</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-3-4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Dalvay</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-4-1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Greenwich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-4-2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Greenwich</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-4-3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Greenwich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-4-4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Greenwich</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Cavendish</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-3-5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Dalvay</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-3-6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Dalvay</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ASC-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Communities</td>
</tr>
<tr class="even">
<td style="text-align: left;">LXI-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Communities</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-1-5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Cavendish</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Cavendish</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-3-7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Dalvay</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-3-8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Dalvay</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-4-6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Greenwich</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-5-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Skmaqn</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-BS-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Bank Swallow Monitoring</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-BS-2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Bank Swallow Monitoring</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-BS-3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Bank Swallow Monitoring</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-BS-4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Bank Swallow Monitoring</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-BS-5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Bank Swallow Monitoring</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-4-5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Greenwich</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-E1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Skmaqn</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-BS-6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Bank Swallow Monitoring</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="data-management" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="data-management">Data management</h2>
<p>A total of 10078 recordings were collected (see <a href="#fig-recs-collect">Figure&nbsp;3</a>). From 2019 - 2021, data were transferred via hard drive to the University of Alberta in Edmonton, where they are redundantly stored on a server known as Cirrus. The recordings were standardized to ensure adherence to the naming convention of <code>LOCATION_DATETIME</code>, such as <code>PENP-1-1_20230625_053500.wav</code>. The remaining recordings (2022 - 2023) were directly uploaded to WildTrax by Parks Canada staff and can be downloaded from the platform’s Recording tab, accessible under Manage &gt; Download list of recordings (see <a href="#fig-download-recs">Figure&nbsp;2</a>).</p>
<div id="fig-download-recs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="download-recs.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Downloading a list of recordings from WildTrax</figcaption>
</figure>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-recs-collect" class="quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="peinp_files/figure-html/fig-recs-collect-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption margin-caption">Figure&nbsp;3: Ridgeplot of recordings collected for each location over each survey year</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="community-data-processing" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="community-data-processing">Community data processing</h2>
<p>The principal goal for data processing was to describe the acoustic community of species heard at locations while choosing a large enough subset of recordings for analyses. To ensure balanced replication, for each location and year surveyed, four randomly selected recordings were processed for 3-minutes between the hours of 4:00 AM - 7:59 AM ideally on four separate dates (see <a href="#tbl-loc-repl">Table&nbsp;2</a>). Four recordings will ensure that we have the minimum number of samples for a simple occupancy analysis (<span class="citation" data-cites="occu-less-than-one">MacKenzie, Nichols, Lachman, et al. (<a href="#ref-occu-less-than-one" role="doc-biblioref">n.d.</a>)</span> and <span class="citation" data-cites="imperfect-occu">MacKenzie, Nichols, Hines, et al. (<a href="#ref-imperfect-occu" role="doc-biblioref">n.d.</a>)</span>). Tags are made using count-removal (<span class="citation" data-cites="time-removal">Sólymos et al. (<a href="#ref-time-removal" role="doc-biblioref">2018</a>)</span>) where tags are only made at the time of first detection of each individual heard on the recordings. In case a species was overly abundant a TMTT (‘too many to tag’) flag was used (see <a href="#tbl-tmtt">Table&nbsp;4</a>). We also verified that all tags that were created were checked by a second observer to ensure accuracy of detections (see <a href="#tbl-verified">Table&nbsp;3</a>). Amphibian abundance was estimated at the time of first detection using the <a href="https://www.usgs.gov/centers/eesc/science/north-american-amphibian-monitoring-program">North American Amphibian Monitoring Program</a> with abundance of species being estimated on the scale of “calling intensity index” of 1 - 3. Mammals such as Red Squirrel, were also noted on the recordings.</p>
<div class="no-row-height column-margin column-container"><div id="ref-occu-less-than-one" class="csl-entry" role="listitem">
MacKenzie, Darryl I., James D. Nichols, Gideon B. Lachman, Sam Droege, J. Andrew Royle, and Catherine A. Langtimm. n.d. <span>“Estimating Site Occupancy Rates When Detection Probabilities Are Less Than One.”</span> <em>Ecology</em> 83 (8): 2248–55. https://doi.org/<a href="https://doi.org/10.1890/0012-9658(2002)083[2248:ESORWD]2.0.CO;2">https://doi.org/10.1890/0012-9658(2002)083[2248:ESORWD]2.0.CO;2</a>.
</div><div id="ref-imperfect-occu" class="csl-entry" role="listitem">
MacKenzie, Darryl I., James D. Nichols, James E. Hines, Melinda G. Knutson, and Alan B. Franklin. n.d. <span>“Estimating Site Occupancy, Colonization, and Local Extinction When a Species Is Detected Imperfectly.”</span> <em>Ecology</em> 84 (8): 2200–2207. https://doi.org/<a href="https://doi.org/10.1890/02-3090">https://doi.org/10.1890/02-3090</a>.
</div><div id="ref-time-removal" class="csl-entry" role="listitem">
Sólymos, Péter, Steven M. Matsuoka, Steven G. Cumming, Diana Stralberg, Patricia Fontaine, Fiona K. A. Schmiegelow, Samantha J. Song, and Erin M. Bayne. 2018. <span>“<span class="nocase">Evaluating time-removal models for estimating availability of boreal birds during point count surveys: Sample size requirements and model complexity</span>.”</span> <em>The Condor</em> 120 (4): 765–86. <a href="https://doi.org/10.1650/CONDOR-18-32.1">https://doi.org/10.1650/CONDOR-18-32.1</a>.
</div></div><p>After the data are processed in WildTrax, the <a href="https://abbiodiversity.github.io/wildRtrax/">wildRtrax</a> package is use to download the data into a standard format prepared for analysis.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-loc-repl" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;2: Example of tasks and unit replication for listening at PENP-1-1</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">task_duration</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">typ</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">180s</td>
<td style="text-align: left;">Dawn</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">180s</td>
<td style="text-align: left;">Day</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">180s</td>
<td style="text-align: left;">Dawn</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">180s</td>
<td style="text-align: left;">Day</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">2021</td>
<td style="text-align: left;">180s</td>
<td style="text-align: left;">Night</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">180s</td>
<td style="text-align: left;">Dawn</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: right;">2023</td>
<td style="text-align: left;">180s</td>
<td style="text-align: left;">Dawn</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-verified" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;3: Proportion of tags verified</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Tag is verified</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: right;">168</td>
<td style="text-align: right;">1.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">f</td>
<td style="text-align: right;">2927</td>
<td style="text-align: right;">28.82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">t</td>
<td style="text-align: right;">7060</td>
<td style="text-align: right;">69.52</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-tmtt" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;4: TMTT tags</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">recording_date_time</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">species_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">individual_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: left;">2019-06-01 05:25:00</td>
<td style="text-align: left;">AMCR</td>
<td style="text-align: left;">TMTT</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: left;">2019-06-01 05:25:00</td>
<td style="text-align: left;">AMRE</td>
<td style="text-align: left;">TMTT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: left;">2019-06-02 06:24:00</td>
<td style="text-align: left;">YEWA</td>
<td style="text-align: left;">TMTT</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: left;">2019-06-02 06:24:00</td>
<td style="text-align: left;">AMCR</td>
<td style="text-align: left;">TMTT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: left;">2019-06-02 06:24:00</td>
<td style="text-align: left;">AMRE</td>
<td style="text-align: left;">TMTT</td>
</tr>
<tr class="even">
<td style="text-align: left;">PENP-1-1</td>
<td style="text-align: left;">2019-06-04 07:23:00</td>
<td style="text-align: left;">AMRE</td>
<td style="text-align: left;">TMTT</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="visual-scanning" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="visual-scanning">Visual scanning</h2>
<p>Visual scanning is the concept of visually examining spectrograms in order to find a signal within an audio recording. Visual scanning can be a useful processing method allowing trained users to process recordings much faster than traditional listening. It has been used for detecting different taxa (<span class="citation" data-cites="vis-scan-amphs">Cameron et al. (<a href="#ref-vis-scan-amphs" role="doc-biblioref">2020</a>)</span>, <span class="citation" data-cites="aru-vs-cams-wolves">Garland et al. (<a href="#ref-aru-vs-cams-wolves" role="doc-biblioref">2020</a>)</span>) with comparable biological metrics, as well as helping to maximize species detection in large acoustic monitoring data sets (<span class="citation" data-cites="all-the-scans">Ware et al. (<a href="#ref-all-the-scans" role="doc-biblioref">2023</a>)</span>). WildTrax’s project settings and dynamic spectrogram settings in the processing interface allow users to upload many recordings, while also allowing frequency-limited or time-limited spectrograms. These changes are easily made by adjusting project settings in WildTrax.</p>
<div class="no-row-height column-margin column-container"><div id="ref-vis-scan-amphs" class="csl-entry" role="listitem">
Cameron, J., A. Crosby, C. Paszkowski, and E. Bayne. 2020. <span>“Visual Spectrogram Scanning Paired with an Observation–Confirmation Occupancy Model Improves the Efficiency and Accuracy of Bioacoustic Anuran Data.”</span> <em>Canadian Journal of Zoology</em> 98 (11): 733–42. <a href="https://doi.org/10.1139/cjz-2020-0103">https://doi.org/10.1139/cjz-2020-0103</a>.
</div><div id="ref-aru-vs-cams-wolves" class="csl-entry" role="listitem">
Garland, Laura, Andrew Crosby, Richard Hedley, Stan Boutin, and Erin Bayne. 2020. <span>“Acoustic Vs. Photographic Monitoring of Gray Wolves (<span class="nocase">Canis lupus</span>): A Methodological Comparison of Two Passive Monitoring Techniques.”</span> <em>Canadian Journal of Zoology</em> 98 (3): 219–28. <a href="https://doi.org/10.1139/cjz-2019-0081">https://doi.org/10.1139/cjz-2019-0081</a>.
</div><div id="ref-all-the-scans" class="csl-entry" role="listitem">
Ware, Lena, C. Lisa Mahon, Logan McLeod, and Jean-François Jetté. 2023. <span>“Artificial Intelligence (BirdNET) Supplements Manual Methods to Maximize Bird Species Richness from Acoustic Data Sets Generated from Regional Monitoring.”</span> <em>Canadian Journal of Zoology</em> 101 (12): 1031–51. <a href="https://doi.org/10.1139/cjz-2023-0044">https://doi.org/10.1139/cjz-2023-0044</a>.
</div></div><p>In order to determine presence of Bank Swallow (BANS) at <code>PENP-BS-*</code> site, visual scanning was employed to identify the time of first detection of the species on recordings at these locations. A total of 65 recordings were visually scanned for BANS. Tags were made at the time of first detection in each minute interval.</p>
</section>
<section id="automated-recognition" class="level2">
<h2 class="anchored" data-anchor-id="automated-recognition">Automated recognition</h2>
<p>Automated recognition is a well-known process to help detect rare and elusive species (@), species that may have low detectability in large data sets (@). We constructed a recognizer for EAWP and used three previously constructed Wildlife Acoustics SongScope recognizer for OSFL, RUBL and CAWA. Hits were uploaded to WildTrax via the <code>wt_songscope_tags</code> function in <code>wildRtrax</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wt_songscope_tags</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="results" class="level1 page-columns page-full">
<h1>Results</h1>
<section id="avian-species" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="avian-species">Avian species</h2>
<section id="species-richness" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="species-richness">Species richness</h3>
<p>A total of 100 species were found across the five years. <a href="#fig-spp-rich-locs">Figure&nbsp;4</a> describes the relationship of species richness across each location and survey year with <a href="#fig-spp-rich-annual">Figure&nbsp;5</a> showing the relationship between species richness and survey effort.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-spp-rich-locs" class="quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="peinp_files/figure-html/fig-spp-rich-locs-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption margin-caption">Figure&nbsp;4: Species richness at forest monitoring locations across years</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-spp-rich-annual" class="quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="peinp_files/figure-html/fig-spp-rich-annual-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption margin-caption">Figure&nbsp;5: Species richness at forest monitoring locations across years considering sampling effort</figcaption>
</figure>
</div>
</div>
</div>
<div id="tbl-bird-guilds" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Bird guilds. For nesting habitat; Ag = Agricultural, Be = Beach, Bo = Bog, CW = Coniferous Woodlands, ES = Early Successional, MW = Mixed Woodlands, OW = Open Woodlands, TSS = Treed/Shrubby Swamp, Ur = Urban.">

</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-spp-activity" class="quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="peinp_files/figure-html/fig-spp-activity-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption margin-caption">Figure&nbsp;6: Seasonal detection activity of most commonly detected forest species</figcaption>
</figure>
</div>
</div>
</div>
<p>A quick test to show proximity to ocean is the major effect of noise and species richness on audio data so that we can use that site covariate in the occupany models.</p>
</section>
<section id="species-diversity" class="level3">
<h3 class="anchored" data-anchor-id="species-diversity">Species diversity</h3>
</section>
<section id="species-occupancy" class="level3">
<h3 class="anchored" data-anchor-id="species-occupancy">Species occupancy</h3>
<p>For testing species occupancy, we selected locations with a minimum of four dawn visits across all five years, focusing on forest obligate species for ecological relevance (see <strong>?@tbl-bird-guilds</strong>). Utilizing a single-season single-species occupancy model (see <a href="#fig-spp-occ">Figure&nbsp;7</a>) from Mackenzie et al.&nbsp;2003. Site-specific covariates included the distance to the ocean edge and the proportion of forested area surrounding the ARU. Observation covariates incorporated day of the year, hour, observer details, and a quadratic term for both year and hour. Despite variations in methodology between 2019 (1SPM) and subsequent years (2020 - 2023), we maintained consistency by exclusively utilizing the time to the first detection of individuals from the 1SPM recordings. Model predictions were then generated, and the best model was selected based on the Aikaike Information Criterion (AIC).</p>
<div class="cell" data-fig-column="page-right">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "REVI" "AMRE" "BTNW" "NOPA" "MAWA" "SWTH" "ALFL" "YRWA" "BAWW" "BHVI"
[11] "BLJA" "CHSP" "BTBW" "BLBW" "GCKI" "MOWA" "HETH" "CSWA" "EAWP" "YBSA"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-spp-occ" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="peinp_files/figure-html/fig-spp-occ-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Predicted single season occupancy from forest species with high detections.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="visual-scanning-1" class="level2">
<h2 class="anchored" data-anchor-id="visual-scanning-1">Visual scanning</h2>
<p>BANS were detected at</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pei_main <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species_code <span class="sc">==</span> <span class="st">"BANS"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(location, recording_date_time, species_code, individual_order, individual_count) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   location recording_date_time species_code individual_order individual_count
1 PENP-BS-6 2023-07-16 06:14:00         BANS                1                1
2 PENP-BS-6 2023-07-19 05:17:00         BANS                1                1</code></pre>
</div>
</div>
<hr>
</section>
<section id="amphibians" class="level2">
<h2 class="anchored" data-anchor-id="amphibians">Amphibians</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="peinp_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
</section>
<section id="discussion" class="level1 unnumbered">
<h1 class="unnumbered">Discussion</h1>

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>